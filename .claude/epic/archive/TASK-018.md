# TASK-018: [CRITICAL-Q4] Fix race condition in mDNS discovery BrowseState

**Status:** Done
**Priority:** Critical
**Assignee:** Unassigned
**Created:** 2026-02-02
**Updated:** 2026-02-02

---

## Description

**Source:** Code Review 2026-02-02 (Aegis)
**Severity:** Critical
**Category:** Quality

**Location:** RadioDetector.swift:306-365

**Issue:**
BrowseState class is marked @unchecked Sendable which bypasses Swift's concurrency checks. While locks are present, mutable state mutations aren't consistently protected:
```swift
final class BrowseState: @unchecked Sendable {
    var hasResumed = false
    var discoveredEndpoints: [(NWEndpoint, String)] = []
    var logMessages = ""
    let resumeLock = NSLock()
    let lock = NSLock()
}
```

**Impact:** Possible data races leading to incomplete device lists or crashes.

**Recommendation:**
- Convert to actor for proper isolation
- Or use @MainActor for all mutable state access
- Or ensure ALL access paths use locks consistently

---

---

---

## Acceptance Criteria

- [ ] [Add criteria]

---

## Context

**Why this matters:**
[Business/user context]

**Related:**
- [Link to FRD if applicable]
- [Link to related tasks]

---

## Handoff History

| Time | Agent | Action |
|------|-------|--------|
| 2026-02-02 | System | Created task |

---

## Agent Notes

*Add notes as work progresses*

---

## Blockers

*No blockers*

---

## Completion

**Completed by:** —
**Completed at:** —
**Sign-off:** —

---

*Generated by Ticketmaster*
